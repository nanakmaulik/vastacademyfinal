<!DOCTYPE html>
<html>
<head>
    <style>
        ul {
       list-style-type: none;
       margin: 0;
       padding: 15px;
       overflow: hidden;
       background-color: #FF6600;
       border-radius: 5px;
     }
   
     li {
       float: left;
     }
   
     li a {
       display: block;
       color: #44425A;
       text-align: center;
       padding: 16px 20px; /* Increased padding for larger buttons */
       text-decoration: none;
       font-size: 18px; /* Increased font size */
       font-weight: bold; /* Bold text */
       transition: background-color 0.3s ease; /* Smooth background color transition */
     }
   
     li a:hover:not(.active) {
       background-color: #111;
       color: #fff; /* Text color on hover */
       border-radius: 5px;
     }
   
     .active {
       background-color: #04AA6D;
       color: #fff; /* Text color on the active button */
       border-radius: 5px;
     }
   
     * {
       box-sizing: border-box;
     }
   
     #myInput {
       background-image: url('/css/searchicon.png');
       background-position: 10px 10px;
       background-repeat: no-repeat;
       width: 100%;
       font-size: 16px;
       padding: 12px 20px 12px 40px;
       border: 1px solid #ddd;
       margin-bottom: 12px;
       border-radius: 5px;
     }
   
     #myTable {
       border-collapse: collapse;
       width: 100%;
       border: 1px solid #ddd;
       font-size: 18px;
     }
   
     #myTable th, #myTable td {
       text-align: left;
       padding: 12px;
     }
   
     #myTable tr {
       border-bottom: 1px solid #ddd;
     }
   
     #myTable tr.header, #myTable tr:hover {
       background-color: #f1f1f1;
     }
   
     /* Remove the plus-minus styles */
   
     .value-input {
       width: 80px;
       height: 30px;
       border: 1px solid #ccc;
       border-radius: 5px;
     }
   
     .value-input input {
       width: 100%;
       height: 100%;
       text-align: center;
       font-size: 16px;
       font-weight: bold;
       border: none;
       outline: none;
     }
   </style>
</head>
<body>

<h2 style="margin-left: 600px;">Student'S Points</h2>

<input type="text" id="myInput" onkeyup="myFunction()" placeholder="Search for names.." title="Type in a name">

<table id="myTable">
  <tr class="header">
    <th style="width:30%;">Name</th>
    <th style="width:30%;">Course</th>
    <th style="width:20%;">Points</th>
    <th style="width:20%;">Chat</th> <!-- Add a new column for the chat button -->
  </tr>
</table>

<!-- Add a chat box for each user -->
<div id="chatBoxes" style="display: none;">
  <!-- Each chat box will be added here dynamically -->
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAQFuwvC5Qb4eC7rLj0lkHwuPyb_ovId3A",
  authDomain: "vastacademyfinal.firebaseapp.com",
  projectId: "vastacademyfinal",
  storageBucket: "vastacademyfinal.appspot.com",
  messagingSenderId: "778284690574",
  appId: "1:778284690574:web:11b082c4daf2202b4feddf",
  measurementId: "G-F2HZKQDL51"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const chatsCollection = db.collection("chats");

  // Function to display user data in the table
  function displayUserData() {
    const table = document.getElementById('myTable');
    const chatBoxesDiv = document.getElementById('chatBoxes');

    // Clear existing table rows and chat boxes
    table.innerHTML = `
      <tr class="header">
        <th style="width:30%;">Name</th>
        <th style="width:30%;">Course</th>
        <th style="width:20%;">Points</th>
        <th style="width:20%;">Chat</th>
      </tr>
    `;
    chatBoxesDiv.innerHTML = '';

    // Fetch user data from the 'users' collection in the database and populate the table
    db.collection("users").get().then((querySnapshot) => {
      querySnapshot.forEach((doc) => {
        const userData = doc.data();
        const row = table.insertRow(-1);
        const nameCell = row.insertCell(0);
        const courseCell = row.insertCell(1);
        const pointsCell = row.insertCell(2);
        const chatCell = row.insertCell(3); // Add a new cell for the chat button

        nameCell.textContent = userData.name;
        courseCell.textContent = userData.course;

        // Create an input field for 'points'
        const pointsInput = document.createElement('div');
        pointsInput.classList.add('value-input');
        pointsInput.innerHTML = `<input type="number" value="${userData.points}" />`;

        pointsInput.querySelector('input').addEventListener('change', (event) => {
          // Handle the change in points here
          const newPoints = parseInt(event.target.value);
          // Update the 'points' field in Firestore for this user using doc.id
          db.collection("users").doc(doc.id).update({
            points: newPoints
          });
        });

        pointsCell.appendChild(pointsInput);

        // Create a chat button and chat box for each user
        const chatButton = document.createElement('button');
        chatButton.textContent = 'Chat';
        chatButton.addEventListener('click', () => {
          toggleChatBox(doc.id);
        });

        chatCell.appendChild(chatButton);

        // Create a chat box for the user and hide it initially
        const chatBox = document.createElement('div');
        chatBox.classList.add('chat-box');
        chatBox.style.display = 'none';
        chatBox.innerHTML = `
          <h3>Chat with ${userData.name}</h3>
          <!-- Add your chat interface here -->
        `;

        chatBoxesDiv.appendChild(chatBox);
      });
    });
  }

  // Function to toggle the visibility of the chat box
  function toggleChatBox(userId) {
    const chatBox = document.querySelector(`#chatBoxes .chat-box[data-user="${userId}"]`);
    if (chatBox.style.display === 'none') {
      chatBox.style.display = 'block';
    } else {
      chatBox.style.display = 'none';
    }
  }

  // Call the function to initially display user data
  displayUserData();
</script>
</body>
</html>
